<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊØèÊó•Âõ∫ÂÆö‰ªªÂä° - Êï∞ÊçÆÂÆùÂèçÈ¶à</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .date-display {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .current-time {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .notification-permission {
            background-color: #FFF8E1;
            border: 1px solid #FFC107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .permission-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .permission-btn:hover {
            background-color: #1976D2;
        }
        
        #task-list {
            list-style-type: none;
            padding: 0;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .task-item {
            flex: 1;
            min-width: 280px;
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .task-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .task-text {
            flex: 1;
            margin-left: 15px;
            font-size: 18px;
            font-weight: 500;
        }
        
        .completed {
            text-decoration: line-through;
            color: #888;
        }
        
        .complete-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 15px;
            align-self: flex-end;
        }
        
        .complete-btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        
        .complete-btn.completed {
            background-color: #9E9E9E;
        }
        
        .time-info {
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #eee;
            font-size: 14px;
            color: #666;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .deadline {
            color: #FF5722;
            font-weight: bold;
        }
        
        .overdue {
            border-color: #F44336;
            background-color: #FFEBEE;
        }
        
        .urgent {
            border-color: #FFC107;
            background-color: #FFF8E1;
        }
        
        .critical {
            border-color: #F44336;
            background-color: #FFEBEE;
            animation: pulseCritical 1s infinite;
        }
        
        .time-left {
            font-weight: bold;
            font-size: 16px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 15px;
            display: inline-block;
        }
        
        .status-normal {
            background-color: #4CAF50;
        }
        
        .status-warning {
            background-color: #FFC107;
        }
        
        .status-danger {
            background-color: #F44336;
        }
        
        .status-critical {
            background-color: #F44336;
            animation: blink 1s infinite;
        }
        
        /* ‰∏≠Â§ÆÂºπÁ™óÊ†∑Âºè */
        .center-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .center-modal-content {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            padding: 35px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 50px rgba(255, 0, 0, 0.4);
            animation: modalFadeIn 0.3s ease-out;
            position: relative;
            color: white;
        }
        
        .modal-icon {
            font-size: 60px;
            margin-bottom: 25px;
            animation: pulseUrgent 0.8s infinite;
        }
        
        .modal-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .modal-message {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            font-weight: 500;
        }
        
        .modal-task-info {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }
        
        .modal-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .modal-btn-primary {
            background-color: white;
            color: #ff6b6b;
        }
        
        .modal-btn-primary:hover {
            background-color: #f8f9fa;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-btn-secondary {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .modal-btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.8);
            transition: color 0.3s ease;
        }
        
        .modal-close:hover {
            color: white;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-40px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes pulseUrgent {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes pulseCritical {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            font-size: 14px;
        }

        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {
            #task-list {
                flex-direction: column;
            }
            
            .task-item {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <h1>üìã ÊØèÊó•Âõ∫ÂÆö‰ªªÂä°ÊèêÈÜí</h1>
    
    <div class="container">
        <div class="header">
            <div class="date-display" id="date-display">2023Âπ¥12Êúà15Êó• ÊòüÊúü‰∫î</div>
            <div class="current-time" id="current-time">00:00:00</div>
        </div>
        
        <div id="notification-permission" class="notification-permission">
            <p>üîî ËØ∑ÂÖÅËÆ∏ÊµèËßàÂô®ÈÄöÁü•ÊùÉÈôêÔºå‰ª•‰æøÂú®‰ªªÂä°Âà∞ÊúüÊó∂Êî∂Âà∞ÊèêÈÜí</p>
            <button class="permission-btn" id="request-permission">ÂêØÁî®ÈÄöÁü•ÊùÉÈôê</button>
        </div>
        
        <ul id="task-list"></ul>
    </div>
    
    <!-- ‰∏≠Â§ÆÂºπÁ™ó -->
    <div id="center-modal" class="center-modal">
        <div class="center-modal-content">
            <button class="modal-close" id="modal-close">√ó</button>
            <div class="modal-icon">üö®</div>
            <div class="modal-title">Á¥ßÊÄ•ÔºÅÊØèÊó•‰ªªÂä°Âç≥Â∞ÜÂà∞ÊúüÔºÅ</div>
            <div class="modal-message" id="modal-message"></div>
            <div class="modal-task-info" id="modal-task-info"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" id="modal-view-tasks">Á´ãÂç≥Â§ÑÁêÜ</button>
                <button class="modal-btn modal-btn-secondary" id="modal-close-btn">ÊàëÁü•ÈÅì‰∫Ü</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        ÊØèÊó•Âõ∫ÂÆö‰ªªÂä°ÊèêÈÜíÁ≥ªÁªü - Êï∞ÊçÆÂÆùÂèçÈ¶à
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const taskList = document.getElementById('task-list');
            const permissionBtn = document.getElementById('request-permission');
            const permissionPanel = document.getElementById('notification-permission');
            const dateDisplay = document.getElementById('date-display');
            const currentTime = document.getElementById('current-time');
            
            // ‰∏≠Â§ÆÂºπÁ™óÂÖÉÁ¥†
            const centerModal = document.getElementById('center-modal');
            const modalMessage = document.getElementById('modal-message');
            const modalTaskInfo = document.getElementById('modal-task-info');
            const modalClose = document.getElementById('modal-close');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalViewTasks = document.getElementById('modal-view-tasks');
            
            // Ê£ÄÊü•ÈÄöÁü•ÊùÉÈôêÁä∂ÊÄÅ
            let notificationPermission = Notification.permission;
            updatePermissionUI();
            
            // Â≠òÂÇ®Â∑≤ÊèêÈÜíÁöÑ‰ªªÂä°IDÔºàÈò≤Ê≠¢ÈáçÂ§çÊèêÈÜíÔºâ
            const remindedTasks = new Set();
            let currentReminderTask = null;
            
            // ÊØèÊó•Âõ∫ÂÆö‰ªªÂä°ÈÖçÁΩÆÔºàÊñ∞Â¢û‰∫ÜÁ¨¨ÂçÅ‰∏Ä‰∏™‰ªªÂä°Ôºâ
            const dailyTasks = [
                {
                    id: 'databao-feedback',
                    name: 'ÂèçÈ¶àÊï∞ÊçÆÂÆù',
                    deadlineTime: '07:20', // ÊØèÂ§©Êó©‰∏ä7:20
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'weather-check',
                    name: 'Êü•ÁúãÂ§úÈó¥Â§©Ê∞îÁé∞Ë±°',
                    deadlineTime: '08:00', // ÊØèÂ§©Êó©‰∏ä8:00
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'qizhengyou-notice-morning',
                    name: 'Êü•ÁúãÊ∞îÊîøÈÇÆÂÖ≥‰∫é‰∏öÂä°ÁöÑÈÄöÁü•',
                    deadlineTime: '08:30', // ÊØèÂ§©Êó©‰∏ä8:30
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'inspect-field-morning',
                    name: 'Â∑°ËßÜÊµãÂú∫',
                    deadlineTime: '10:20', // ÊØèÂ§©‰∏äÂçà10:20
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'check-stations-morning',
                    name: 'Êü•ÁúãÂêÑÂå∫ÂüüÁ´ô„ÄÅÂúüÂ£§Ê∞¥ÂàÜ‰ªΩÁ´ô„ÄÅÈõ∑ÁîµÁ´ô„ÄÅÊ∞¥Ê±ΩÁ´ôÊòØÂê¶Ê≠£Â∏∏',
                    deadlineTime: '10:30', // ÊØèÂ§©‰∏äÂçà10:30
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'qizhengyou-notice-afternoon',
                    name: 'Êü•ÁúãÊ∞îÊîøÈÇÆÂÖ≥‰∫é‰∏öÂä°ÁöÑÈÄöÁü•',
                    deadlineTime: '15:00', // ÊØèÂ§©‰∏ãÂçà15:00
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'inspect-field-afternoon',
                    name: 'Â∑°ËßÜÊµãÂú∫',
                    deadlineTime: '15:30', // ÊØèÂ§©‰∏ãÂçà15:30
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'check-stations-afternoon',
                    name: 'Êü•ÁúãÂêÑÂå∫ÂüüÁ´ô„ÄÅÂúüÂ£§Ê∞¥ÂàÜ‰ªΩÁ´ô„ÄÅÈõ∑ÁîµÁ´ô„ÄÅÊ∞¥Ê±ΩÁ´ôÊòØÂê¶Ê≠£Â∏∏',
                    deadlineTime: '16:00', // ÊØèÂ§©‰∏ãÂçà16:00
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'create-24h-forecast',
                    name: 'Âà∂‰Ωú24Â∞èÊó∂Â§©Ê∞îÈ¢ÑÊä•',
                    deadlineTime: '16:15', // ÊØèÂ§©‰∏ãÂçà16:15
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'check-afternoon-report',
                    name: 'Êü•Áúã‰∏ãÂçàÊä•ÊñáÊòØÂê¶Ê≠£Â∏∏',
                    deadlineTime: '17:00', // ÊØèÂ§©‰∏ãÂçà17:00
                    completed: false,
                    completedTime: null
                },
                {
                    id: 'check-daytime-report',
                    name: 'Êü•ÁúãÁôΩÂ§©Êä•ÊñáÊòØÂê¶Ê≠£Â∏∏',
                    deadlineTime: '20:00', // ÊØèÂ§©Êôö‰∏ä20:00
                    completed: false,
                    completedTime: null
                }
            ];
            
            // Êõ¥Êñ∞Êó•ÊúüÂíåÊó∂Èó¥ÊòæÁ§∫
            function updateDateTime() {
                const now = new Date();
                const options = { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric', 
                    weekday: 'long' 
                };
                dateDisplay.textContent = now.toLocaleDateString('zh-CN', options);
                currentTime.textContent = now.toLocaleTimeString('zh-CN');
            }
            
            // ÂàùÂßãÂåñÊó•ÊúüÊó∂Èó¥ÊòæÁ§∫
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Êõ¥Êñ∞ÊùÉÈôêUIÊòæÁ§∫
            function updatePermissionUI() {
                if (notificationPermission === 'granted') {
                    permissionPanel.style.display = 'none';
                } else {
                    permissionPanel.style.display = 'block';
                }
            }
            
            // ËØ∑Ê±ÇÈÄöÁü•ÊùÉÈôê
            permissionBtn.addEventListener('click', async function() {
                try {
                    const permission = await Notification.requestPermission();
                    notificationPermission = permission;
                    updatePermissionUI();
                    
                    if (permission === 'granted') {
                        showDesktopNotification('ÈÄöÁü•ÊùÉÈôêÂ∑≤ÂêØÁî®', 'ÊØèÊó•‰ªªÂä°Âà∞ÊúüÂâç10ÂàÜÈíüÊÇ®Â∞ÜÊî∂Âà∞Á¥ßÊÄ•ÊèêÈÜíÔºÅ');
                    }
                } catch (error) {
                    console.error('ËØ∑Ê±ÇÈÄöÁü•ÊùÉÈôêÂ§±Ë¥•:', error);
                }
            });
            
            // ÊòæÁ§∫Ê°åÈù¢ÈÄöÁü•
            function showDesktopNotification(title, message) {
                if (notificationPermission !== 'granted') return;
                
                if (!('Notification' in window)) {
                    console.log('ËØ•ÊµèËßàÂô®‰∏çÊîØÊåÅÊ°åÈù¢ÈÄöÁü•');
                    return;
                }
                
                try {
                    const notification = new Notification(title, {
                        body: message,
                        icon: 'https://cdn-icons-png.flaticon.com/512/411/411745.png',
                        tag: 'daily-task-reminder',
                        requireInteraction: true
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        notification.close();
                    };
                    
                    setTimeout(() => {
                        notification.close();
                    }, 8000);
                    
                    return notification;
                } catch (error) {
                    console.error('ÂàõÂª∫ÈÄöÁü•Â§±Ë¥•:', error);
                }
            }
            
            // ÊòæÁ§∫‰∏≠Â§ÆÂºπÁ™ó
            function showCenterModal(task) {
                const now = new Date();
                const deadline = getTodayDeadline(task.deadlineTime);
                const minutesLeft = Math.max(0, Math.floor((deadline - now) / 60000));
                
                currentReminderTask = task;
                
                modalMessage.textContent = `Á¥ßÊÄ•ÔºÅÊØèÊó•‰ªªÂä°Â∞ÜÂú®${minutesLeft}ÂàÜÈíüÂêéÂà∞ÊúüÔºÅ`;
                modalTaskInfo.innerHTML = `
                    <strong>‰ªªÂä°ÂêçÁß∞:</strong> ${task.name}<br>
                    <strong>Êà™Ê≠¢Êó∂Èó¥:</strong> ‰ªäÊó• ${task.deadlineTime}<br>
                    <strong>Ââ©‰ΩôÊó∂Èó¥:</strong> ${minutesLeft}ÂàÜÈíü
                `;
                
                centerModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                
                // Êí≠ÊîæÊèêÁ§∫Èü≥
                playAlertSound();
            }
            
            // Êí≠ÊîæÊèêÁ§∫Èü≥
            function playAlertSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (error) {
                    console.log('Êó†Ê≥ïÊí≠ÊîæÊèêÁ§∫Èü≥:', error);
                }
            }
            
            // ÂÖ≥Èó≠‰∏≠Â§ÆÂºπÁ™ó
            function closeCenterModal() {
                centerModal.style.display = 'none';
                document.body.style.overflow = 'auto';
                currentReminderTask = null;
            }
            
            // ÂºπÁ™ó‰∫ã‰ª∂ÁõëÂê¨
            modalClose.addEventListener('click', closeCenterModal);
            modalCloseBtn.addEventListener('click', closeCenterModal);
            modalViewTasks.addEventListener('click', function() {
                closeCenterModal();
                window.scrollTo(0, 0);
            });
            
            // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
            centerModal.addEventListener('click', function(e) {
                if (e.target === centerModal) {
                    closeCenterModal();
                }
            });
            
            // ESCÈîÆÂÖ≥Èó≠ÂºπÁ™ó
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && centerModal.style.display === 'flex') {
                    closeCenterModal();
                }
            });
            
            // Ëé∑Âèñ‰ªäÂ§©ÁöÑÊà™Ê≠¢Êó∂Èó¥
            function getTodayDeadline(timeString) {
                const [hours, minutes] = timeString.split(':').map(Number);
                const today = new Date();
                today.setHours(hours, minutes, 0, 0);
                return today;
            }
            
            // Ê†ºÂºèÂåñÊó∂Èó¥ÊòæÁ§∫
            function formatTime(date) {
                return date.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            }
            
            // ËÆ°ÁÆóÂâ©‰ΩôÊó∂Èó¥
            function getTimeLeft(deadline) {
                const now = new Date();
                const diff = deadline - now;
                
                if (diff <= 0) {
                    return 'Â∑≤ËøáÊúü';
                }
                
                const minutes = Math.floor(diff / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                if (minutes < 1) {
                    return `${seconds}Áßí`;
                }
                return `${minutes}ÂàÜÈíü`;
            }
            
            // Ê∏≤Êüì‰ªªÂä°ÂàóË°®
            function renderTasks() {
                taskList.innerHTML = '';
                
                dailyTasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = 'task-item';
                    li.id = `task-${task.id}`;
                    
                    // ‰ªªÂä°Â§¥ÈÉ®ÔºàÁä∂ÊÄÅÊåáÁ§∫Âô®Âíå‰ªªÂä°ÂêçÁß∞Ôºâ
                    const taskHeader = document.createElement('div');
                    taskHeader.className = 'task-header';
                    
                    const statusIndicator = document.createElement('span');
                    statusIndicator.className = 'status-indicator status-normal';
                    
                    const taskText = document.createElement('span');
                    taskText.className = 'task-text';
                    taskText.textContent = task.name;
                    
                    if (task.completed) {
                        taskText.classList.add('completed');
                    }
                    
                    taskHeader.appendChild(statusIndicator);
                    taskHeader.appendChild(taskText);
                    
                    const completeBtn = document.createElement('button');
                    completeBtn.className = `complete-btn ${task.completed ? 'completed' : ''}`;
                    completeBtn.textContent = task.completed ? 'Â∑≤ÂÆåÊàê' : 'Ê†áËÆ∞ÂÆåÊàê';
                    completeBtn.addEventListener('click', () => toggleTaskCompletion(task));
                    
                    const timeInfo = document.createElement('div');
                    timeInfo.className = 'time-info';
                    
                    const deadlineElement = document.createElement('span');
                    deadlineElement.className = 'deadline';
                    deadlineElement.textContent = `ÊØèÊó•Êà™Ê≠¢: ${task.deadlineTime}`;
                    
                    const timeLeftElement = document.createElement('span');
                    timeLeftElement.className = 'time-left';
                    
                    const completedTimeElement = document.createElement('span');
                    completedTimeElement.className = 'completed-time';
                    completedTimeElement.textContent = task.completed ? 
                        `ÂÆåÊàêÊó∂Èó¥: ${formatTime(new Date(task.completedTime))}` : 'Êú™ÂÆåÊàê';
                    
                    timeInfo.appendChild(deadlineElement);
                    timeInfo.appendChild(timeLeftElement);
                    timeInfo.appendChild(completedTimeElement);
                    
                    li.appendChild(taskHeader);
                    li.appendChild(timeInfo);
                    li.appendChild(completeBtn);
                    
                    taskList.appendChild(li);
                    
                    // ÂàùÂßãÊõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ
                    updateTaskStatus(task, li);
                });
            }
            
            // Êõ¥Êñ∞‰ªªÂä°Áä∂ÊÄÅ
            function updateTaskStatus(task, li) {
                const deadline = getTodayDeadline(task.deadlineTime);
                const now = new Date();
                const diff = deadline - now;
                const timeLeftElement = li.querySelector('.time-left');
                const statusIndicator = li.querySelector('.status-indicator');
                const completeBtn = li.querySelector('.complete-btn');
                
                // ÁßªÈô§ÊâÄÊúâÁä∂ÊÄÅÁ±ª
                li.classList.remove('overdue', 'urgent', 'critical');
                statusIndicator.className = 'status-indicator';
                
                if (task.completed) {
                    statusIndicator.classList.add('status-normal');
                    timeLeftElement.textContent = 'Â∑≤ÂÆåÊàê';
                    timeLeftElement.style.color = '#4CAF50';
                    completeBtn.textContent = 'Â∑≤ÂÆåÊàê';
                    completeBtn.classList.add('completed');
                    return;
                }
                
                if (diff <= 0) {
                    // Â∑≤ËøáÊúü
                    li.classList.add('overdue');
                    statusIndicator.classList.add('status-danger');
                    timeLeftElement.textContent = '‰ªäÊó•Â∑≤ËøáÊúü';
                    timeLeftElement.style.color = '#F44336';
                } else if (diff < 10 * 60 * 1000) {
                    // 10ÂàÜÈíüÂÜÖÂà∞Êúü - Á¥ßÊÄ•Áä∂ÊÄÅ
                    li.classList.add('critical');
                    statusIndicator.classList.add('status-critical');
                    timeLeftElement.textContent = `Ââ©‰Ωô: ${getTimeLeft(deadline)}`;
                    timeLeftElement.style.color = '#F44336';
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶Å10ÂàÜÈíüÊèêÈÜí
                    const tenMinutesBefore = new Date(deadline.getTime() - 10 * 60 * 1000);
                    if (now >= tenMinutesBefore && now < deadline) {
                        const taskId = `${task.id}-${deadline.toDateString()}`;
                        
                        if (!remindedTasks.has(taskId)) {
                            remindedTasks.add(taskId);
                            
                            // ÊòæÁ§∫‰∏≠Â§ÆÂºπÁ™ó
                            showCenterModal(task);
                            
                            // ÂêåÊó∂ÂèëÈÄÅÊ°åÈù¢ÈÄöÁü•
                            showDesktopNotification(
                                'üö® Á¥ßÊÄ•ÔºÅÊØèÊó•‰ªªÂä°Âç≥Â∞ÜÂà∞Êúü',
                                `"${task.name}" Â∞ÜÂú®${Math.floor(diff/60000)}ÂàÜÈíüÂêéÂà∞ÊúüÔºÅ`
                            );
                        }
                    }
                } else if (diff < 60 * 60 * 1000) {
                    // 1Â∞èÊó∂ÂÜÖÂà∞Êúü
                    li.classList.add('urgent');
                    statusIndicator.classList.add('status-warning');
                    timeLeftElement.textContent = `Ââ©‰Ωô: ${getTimeLeft(deadline)}`;
                    timeLeftElement.style.color = '#FF9800';
                } else {
                    // Ê≠£Â∏∏Áä∂ÊÄÅ
                    statusIndicator.classList.add('status-normal');
                    timeLeftElement.textContent = `Ââ©‰Ωô: ${getTimeLeft(deadline)}`;
                    timeLeftElement.style.color = '#2196F3';
                }
                
                completeBtn.textContent = 'Ê†áËÆ∞ÂÆåÊàê';
                completeBtn.classList.remove('completed');
            }
            
            // ÂàáÊç¢‰ªªÂä°ÂÆåÊàêÁä∂ÊÄÅ
            function toggleTaskCompletion(task) {
                if (task.completed) {
                    task.completed = false;
                    task.completedTime = null;
                } else {
                    task.completed = true;
                    task.completedTime = new Date().getTime();
                }
                
                // ‰øùÂ≠òÂà∞localStorage
                saveTaskState();
                
                // ÈáçÊñ∞Ê∏≤Êüì
                renderTasks();
            }
            
            // ‰øùÂ≠ò‰ªªÂä°Áä∂ÊÄÅÂà∞localStorage
            function saveTaskState() {
                const taskState = dailyTasks.map(task => ({
                    id: task.id,
                    completed: task.completed,
                    completedTime: task.completedTime
                }));
                localStorage.setItem('dailyTasksState', JSON.stringify(taskState));
            }
            
            // ‰ªélocalStorageÂä†ËΩΩ‰ªªÂä°Áä∂ÊÄÅ
            function loadTaskState() {
                const savedState = localStorage.getItem('dailyTasksState');
                if (savedState) {
                    const taskState = JSON.parse(savedState);
                    dailyTasks.forEach(task => {
                        const savedTask = taskState.find(t => t.id === task.id);
                        if (savedTask) {
                            task.completed = savedTask.completed;
                            task.completedTime = savedTask.completedTime;
                        }
                    });
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÈáçÁΩÆÂÆåÊàêÁä∂ÊÄÅÔºàÊñ∞ÁöÑ‰∏ÄÂ§©Ôºâ
                const lastReset = localStorage.getItem('lastResetDate');
                const today = new Date().toDateString();
                
                if (lastReset !== today) {
                    // Êñ∞ÁöÑ‰∏ÄÂ§©ÔºåÈáçÁΩÆÊâÄÊúâ‰ªªÂä°ÁöÑÂÆåÊàêÁä∂ÊÄÅ
                    dailyTasks.forEach(task => {
                        task.completed = false;
                        task.completedTime = null;
                    });
                    localStorage.setItem('lastResetDate', today);
                    saveTaskState();
                }
            }
            
            // ÂàùÂßãÂåñ
            function init() {
                loadTaskState();
                renderTasks();
                
                // ÊØè30ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°‰ªªÂä°Áä∂ÊÄÅ
                setInterval(() => {
                    dailyTasks.forEach(task => {
                        const li = document.getElementById(`task-${task.id}`);
                        if (li) {
                            updateTaskStatus(task, li);
                        }
                    });
                }, 30000);
            }
            
            // ÂêØÂä®Â∫îÁî®
            init();
        });
    </script>
</body>
</html>
